---
allowed-tools: Read, Write, mcp__sequential-thinking__sequentialthinking
argument-hint: [workflow-core-json] [project-context-json]
description: Generate executable quality gates based on research
---

# Quality Gates Generation

## Chain Position: 3.5c/7 (Quality Gates Generation)

**Input**: Workflow core + project context with ecosystem and standards
**Output**: Enhanced project-context.json with executable, technology-specific quality gates

## CRITICAL REQUIREMENT

<research_validation_blocking>
STEP 1: BLOCKING - Modular Research Validation

1. Load workflow-core.json from $1
2. Load project-context.json from $2
3. Check if project_context.standards exists and is populated
4. IF standards are empty THEN:
   - Display error: "❌ Industry standards research incomplete"
   - Display command: "Run: /03.5b-research-standards $1 $2"
   - EXIT IMMEDIATELY - do not proceed with gate generation
5. Check if project_context.ecosystem.detectedTechnology exists
6. IF detectedTechnology is empty THEN:
   - Display error: "❌ Ecosystem detection incomplete"
   - Display command: "Run: /03.5a-detect-ecosystem $1 $2 first"
   - EXIT IMMEDIATELY
7. ONLY if both research and detection complete THEN proceed to Step 2
</research_validation_blocking>

## Instructions

**CRITICAL REQUIREMENT - NEXT COMMAND DISPLAY**
You MUST display the complete next task command at the end of execution in the exact format:
`/0x-<command-name> <param1> <param2> <...>`

NEVER provide brief notifications like "You can run /0x-<command> now."
ALWAYS show the complete command with all parameters filled in.
This is NON-NEGOTIABLE and MANDATORY for workflow progression.

<expertise_definition>
You are a quality gates specialist with expertise in:

- Converting industry standards into executable validation logic
- Technology-specific quality gate implementation
- Fail-fast quality assurance mechanisms
- Cross-platform quality validation commands
</expertise_definition>

<generation_methodology>
Generate executable quality gates that actually BLOCK when quality standards are not met.
Focus on ESSENTIAL gates only, avoiding over-engineering.
</generation_methodology>

<execution_process>

### Step 2: MANDATORY - Quality Gates Generation

<gate_generation>
**GENERATE EXECUTABLE QUALITY GATES** based on researched standards:

1. **Test Coverage Gates**:

   ```json
   "test_coverage_gate": {
     "gate_type": "BLOCKING",
     "command": "[detected_coverage_command]",
     "threshold": "[researched_minimum_coverage]",
     "failure_action": "EXIT_IMMEDIATELY",
     "error_message": "Coverage {actual}% below {threshold}% requirement",
     "fix_guidance": "Add tests to reach {threshold}% coverage before proceeding"
   }
   ```

2. **Code Quality Gates**:

   ```json
   "code_quality_gate": {
     "gate_type": "BLOCKING",
     "command": "[detected_linter_command]",
     "max_violations": 0,
     "failure_action": "EXIT_IMMEDIATELY",
     "error_message": "{violation_count} linting violations found",
     "fix_guidance": "Fix all linting violations before proceeding"
   }
   ```

3. **Test Execution Gates**:

   ```json
   "test_execution_gate": {
     "gate_type": "BLOCKING",
     "command": "[detected_test_command]",
     "required_result": "ALL_PASS",
     "failure_action": "EXIT_IMMEDIATELY",
     "error_message": "{failed_count} tests failed",
     "fix_guidance": "Fix failing tests before proceeding"
   }
   ```

4. **Build Validation Gates** (if applicable):

   ```json
   "build_validation_gate": {
     "gate_type": "BLOCKING",
     "command": "[detected_build_command]",
     "required_exit_code": 0,
     "failure_action": "EXIT_IMMEDIATELY",
     "error_message": "Build failed",
     "fix_guidance": "Fix build errors before proceeding"
   }
   ```

**GENERATION VALIDATION**:

- IF essential gates cannot be generated THEN:
  - Display error: "❌ Unable to generate quality gates for {ecosystem}"
  - Display fix: "Verify ecosystem detection and research results"
  - EXIT IMMEDIATELY
- IF gate commands are invalid THEN:
  - Display error: "❌ Generated gate commands are invalid"
  - Display fix: "Re-run ecosystem detection to get valid commands"
  - EXIT IMMEDIATELY
</gate_generation>

### Step 3: MANDATORY - Gate Validation Logic

<validation_logic>
**CREATE BLOCKING ENFORCEMENT LOGIC**:

1. **Gate Execution Pattern**:

   ```markdown
   STEP N: BLOCKING - {Gate Name}
   1. Execute: {gate_command}
   2. IF exit_code != 0 THEN:
      - Display error: "{error_message}"
      - Display fix: "{fix_guidance}"
      - EXIT IMMEDIATELY
   3. Parse command output for quality metrics
   4. IF metrics below threshold THEN:
      - Display error: "Quality gate failed: {specific_failure}"
      - Display fix: "{specific_remediation}"
      - EXIT IMMEDIATELY
   5. ONLY if gate passes THEN proceed to next gate
   ```

2. **Cross-Platform Compatibility**:
   - Generate Windows/Linux/macOS compatible commands
   - Use detected package manager and tools
   - Avoid hardcoded paths and assumptions

3. **Size-Appropriate Gates**:
   - Small projects: Essential gates only (test + lint)
   - Medium projects: Add coverage requirements
   - Large projects: Add performance gates
   - Enterprise projects: Add security and compliance gates

**VALIDATION LOGIC CHECKS**:

- IF logic generation fails THEN:
  - Display error: "❌ Unable to generate validation logic"
  - Display fix: "Check detected tools and research results"
  - EXIT IMMEDIATELY
</validation_logic>

### Step 4: MANDATORY - Workflow JSON Enhancement

<workflow_enhancement>

1. **Add Quality Gates Section to project-context.json**:

   ```json
   {
     "quality_gates": {
       "gate_set_version": "1.0",
       "execution_mode": "BLOCKING",
       "gates": {
         "test_execution": { gate_definition },
         "test_coverage": { gate_definition },
         "code_quality": { gate_definition },
         "build_validation": { gate_definition }
       },
       "enforcement_logic": {
         "fail_fast": true,
         "exit_on_failure": true,
         "remediation_required": true
       },
       "generation_status": "complete"
     }
   }
   ```

2. **Update Project Context**:
   - Merge quality gates with existing project-context.json
   - Preserve ecosystem detection and research data
   - Set generation_status to "complete"
3. **Update relationships.json** with quality gate cross-references

3. **Final Validation**:
   - IF JSON structure is invalid THEN:
     - Display error: "❌ Generated JSON structure is invalid"
     - Display fix: "Check JSON syntax and required fields"
     - EXIT IMMEDIATELY
   - IF write operation fails THEN:
     - Display error: "❌ Failed to update workflow JSON"
     - Display fix: "Check file permissions and disk space"
     - EXIT IMMEDIATELY
</workflow_enhancement>

</execution_process>

## Quality Gate Enforcement

<gate_enforcement_validation>
STEP 5: MANDATORY - Gate Enforcement Validation

1. **Blocking Logic Check**:
   - Verify all gates have EXIT_IMMEDIATELY actions
   - Confirm error messages are specific and actionable
   - Validate fix guidance is provided for each failure

2. **Command Validity Check**:
   - Test generated commands are syntactically valid
   - Verify commands use detected tools only
   - Confirm cross-platform compatibility

3. **Integration Check**:
   - Ensure gates integrate with detected ecosystem
   - Verify gates match researched industry standards
   - Confirm gates are size-appropriate for project

**ENFORCEMENT VALIDATION**:

- IF any validation fails THEN:
  - Display error: "❌ Quality gate enforcement validation failed"
  - Display specific failing criteria
  - EXIT IMMEDIATELY
- IF all validations pass THEN display success summary with gate count
</gate_enforcement_validation>

## Output Requirements

**SUCCESS CRITERIA**:

- ✅ Executable quality gates generated for detected ecosystem
- ✅ All gates have blocking enforcement logic
- ✅ Gates match researched industry standards
- ✅ Cross-platform compatibility ensured
- ✅ generation_status set to "complete"

**FAILURE HANDLING**:

- Gate generation failures MUST result in immediate exit
- All failures MUST provide specific remediation guidance
- No non-blocking or decorative gates allowed

**MANDATORY - DISPLAY THIS EXACT COMMAND:**

```
/dt:workflow:04-generate-code ./.workflow/core/workflow-core.json ./.workflow/implementation/implementation.json [task-id]
```

**CRITICAL**: You MUST display the above command exactly as shown with the actual task-id from implementation.json. Do NOT provide brief notifications or summaries.

## Usage

```bash
Generate quality gates using:
- Workflow core: ${1:?"workflow-core.json path required"}
- Project context: ${2:?"project-context.json path required"}
```

**MANDATORY FINAL REQUIREMENT:**
You MUST conclude by displaying the complete next command in this exact format:

```
/dt:workflow:04-generate-code ./.workflow/core/workflow-core.json ./.workflow/implementation/implementation.json [actual-task-id]
```

Replace [actual-task-id] with the first task ID from implementation.json.
This is NON-NEGOTIABLE. Brief notifications are insufficient and will break the workflow.
